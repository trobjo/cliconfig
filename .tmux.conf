# do not run a login shell
# set -g default-command "${SHELL}"

# allow to view the title over ssh. Otherwise the local command, i.e `ssh <host>` would just have been shown
set-option -g set-titles on
set -g set-titles-string '#{pane_title}'

#status bar
set -g status-style fg=colour8,bg=colour253
set -g status-position top
# if-shell 'test "$SSH_CONNECTION"' 'set -g status off'

# terminfo
# set -g default-terminal screen-256color
# set -g default-terminal "xterm-256color"
# set -ga terminal-overrides ",alacritty:Tc"
set -g default-terminal "alacritty"

# tell Tmux that outside terminal supports true color
set -ga terminal-overrides ",xterm-256color*:Tc"
# bar cursor
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'

# escape time should be 0 on localhost
set -sg escape-time 0
# set first window to index 1 (not 0) to map more to the keyboard layout

set-option -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1

# set scrollback buffer size
# useful for viewing log output (e.g. Docker)
set -g history-limit 20000


# keybindings

# we make sure we can still reach prefix keys over ssh
# if-shell 'test "$SSH_CONNECTION"' 'set-option -g prefix C-a'
# if-shell 'test "$SSH_CONNECTION"' 'bind-key C-a send-prefix'
bind -n M-0 select-window -t 0
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# split panes using | and -
unbind '"'
unbind %
bind t split-window -v
bind s split-window -h
# bind-key t split-window -h "htop"

# this is c-tab in alacritty
bind-key -n C-y next-window

bind-key -n C-h select-pane -L
bind-key -n C-o select-pane -R
bind-key -n C-z select-pane -U
bind-key -n C-t select-pane -D

# this lets me move forward by word
unbind M-f

# see alacritty.yml for more info
bind -n C-v new-window
bind -n C-s kill-pane

# see alacritty
bind -n C-t copy-mode

# mouse -- geez
set -g mouse on

bind-key -T copy-mode 'o' send-keys -X cursor-left
bind-key -T copy-mode 'u' send-keys -X cursor-right
bind-key -T copy-mode 'r' send-keys -X next-word
bind-key -T copy-mode 'l' send-keys -X rectangle-toggle
bind-key -T copy-mode 'f' send-keys -X clear-selection
bind-key -T copy-mode 'g' send-keys -X previous-word
bind-key -T copy-mode 'n' send-keys -X begin-selection

# bind-key -T copy-mode 'j' send-keys -X copy-selection
bind-key -T copy-mode 'j' send-keys -X copy-pipe-and-cancel '/mnt/c/WINDOWS/system32/clip.exe'


bind-key -T copy-mode 'a' send -X start-of-line
bind-key -T copy-mode 's' send -X end-of-line

# set hilight color to light blue
set-window-option -g mode-style bg=colour153

bind-key -T copy-mode 'c' send -X start-of-line\; send-keys Up \; send -X back-to-indentation \; send -X begin-selection \;  send -X end-of-line
bind-key -T copy-mode 't' send-keys Down \; send -X back-to-indentation \; send -X begin-selection \;  send -X end-of-line


# status bar
# set -g status off
set -g status-interval 1
set -g status-right-length 170
set -g status-left ""
set -g window-status-separator ""
set -g status-right "%a %-d %b %H.%M:%S "
# set -g status-right "#(/usr/bin/cut -d ' ' -f 1,2,3 /proc/loadavg) "


# colors separator
setw -g pane-border-style fg=colour19,bg=default
setw -g pane-active-border-style fg=colour19,bg=default

# dimming inactive windows
setw -g window-active-style fg=colour8,bg=color231
setw -g window-style bg=colour255

set -g status-style fg=default,bold

# active window
set -g window-status-current-style 'bg=colour4 fg=colour231'
set -g window-status-current-format '  #I#[fg=colour252]:#[fg=colour231]#T  '

# inactive window
# setw -g window-status-format ' #I#[fg=colour241]:#[fg=colour232]#W#[fg=colour244]#F '
set -g window-status-style 'bg=colour253 fg=colour241'
set -g window-status-format '  #I#[fg=colour249]:#[fg=colour241]#T  '

set -g pane-active-border-style bg=colour253,fg=colour253
set -g pane-border-style fg=colour253,bg=colour253


# set -g @plugin 'roosta/tmux-fuzzback'
# tmux plugins
# run '~/.tmux/plugins/tpm/tpm'

bind-key -n C-x run -b '/home/mbl3702/.tmux/plugins/tmux-fuzzback/scripts/fuzzback.sh'
bind-key -n C-k split-window -v '/usr/bin/fd . --extension gpg --base-directory $HOME/.password-store | sed -e "s/.gpg$//" | sort | fzf --no-multi --preview-window=hidden | read hej ; ((pass $hej | tr -d "\n"  | /mnt/c/WINDOWS/system32/clip.exe) &)'
# bind-key -n C-k run -b "/home/mbl3702/test.sh"
# bind-key -n C-p split-window -v "fzf | /mnt/c/Program\ Files/Sublime\ Text/subl.exe"
# tmux bind-key -n C-p run -b "/home/mbl3702/.local/bin/fzf-tmux"


# if run as "tmux attach", create a session if one does not already exist
new-session -n $HOST
